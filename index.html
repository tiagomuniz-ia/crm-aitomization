<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aitomization Dashboard</title>
  <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
  <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
  <style>
    /* Global styles */
    :root {
      --black: #000000;
      --white: #ffffff;
      --light-gray: #f7f7f7;
      --gray-100: #f1f1f1;
      --gray-200: #e6e6e6;
      --gray-300: #d1d1d1;
      --gray-400: #a8a8a8;
      --gray-500: #757575;
      --gray-600: #555555;
      --gray-700: #3d3d3d;
      --gray-800: #262626;
      --error: #ff3b30;
      --success: #34c759;
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.05);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.03);
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes slideIn {
      from { transform: translateX(20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: var(--font-family);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    html, body {
      height: 100%;
      background-color: var(--black);
      color: var(--white);
      overflow-x: hidden;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
      width: 100%;
    }

    /* Login Page */
    .login-page {
      display: flex;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
      background-color: var(--black);
      padding: 20px;
    }

    .login-container {
      background-color: #121212;
      border-radius: var(--radius-lg);
      padding: 48px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.6s ease-out;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .login-header {
      margin-bottom: 40px;
      text-align: center;
    }

    .login-logo {
      max-width: 200px;
      margin-bottom: 30px;
      height: auto;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.8);
      font-size: 14px;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md);
      background-color: rgba(255, 255, 255, 0.05);
      color: var(--white);
      transition: var(--transition);
    }

    .form-input:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
    }

    .form-input.error {
      border-color: var(--error);
    }

    .error-message {
      color: var(--error);
      font-size: 14px;
      margin-top: 6px;
      display: none;
    }

    .btn {
      display: inline-block;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 500;
      text-align: center;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: var(--transition);
      background-color: var(--white);
      color: var(--black);
      width: 100%;
    }

    .btn:hover {
      background-color: rgba(255, 255, 255, 0.8);
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn:disabled {
      background-color: rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.5);
      cursor: not-allowed;
    }

    /* Dashboard */
    .dashboard {
      display: none;
      min-height: 100vh;
      background-color: #0A0A0A;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      background-color: #121212;
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      transition: var(--transition);
      z-index: 100;
    }

    .sidebar.expanded {
      width: 260px;
    }

    .sidebar.collapsed {
      width: 80px;
    }

    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sidebar-logo {
      height: 32px;
      width: auto;
    }

    .sidebar-toggle {
      background: none;
      border: none;
      color: var(--white);
      cursor: pointer;
      padding: 8px;
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .sidebar-toggle:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .sidebar-nav {
      padding: 24px 16px;
    }

    .nav-item {
      margin-bottom: 8px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .nav-link:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--white);
    }

    .nav-link.active {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--white);
    }

    .nav-icon {
      width: 20px;
      height: 20px;
      margin-right: 16px;
    }

    .nav-text {
      font-size: 14px;
      font-weight: 500;
    }

    /* Main Content */
    .main-content {
      transition: var(--transition);
    }

    .main-content.sidebar-expanded {
      margin-left: 260px;
    }

    .main-content.sidebar-collapsed {
      margin-left: 80px;
    }

    /* Header */
    .dashboard-header {
      background-color: #121212;
      padding: 16px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 99;
    }

    .header-title {
      font-size: 24px;
      font-weight: 600;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .notification-btn {
      background: none;
      border: none;
      color: var(--white);
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      position: relative;
      transition: var(--transition);
    }

    .notification-btn:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .notification-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      width: 8px;
      height: 8px;
      background-color: var(--error);
      border-radius: 50%;
    }

    .profile-dropdown {
      position: relative;
    }

    .profile-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      background: none;
      border: none;
      color: var(--white);
      cursor: pointer;
      padding: 8px 16px;
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .profile-btn:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .profile-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .profile-name {
      font-size: 14px;
      font-weight: 500;
    }

    .profile-menu {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      background-color: #1A1A1A;
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-lg);
      min-width: 200px;
      padding: 8px 0;
      display: none;
    }

    .profile-menu.show {
      display: block;
      animation: fadeIn 0.2s ease-out;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      color: var(--white);
      text-decoration: none;
      transition: var(--transition);
    }

    .menu-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .menu-item.danger {
      color: var(--error);
    }

    /* Content Area */
    .content-area {
      padding: 32px;
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease-out;
    }

    .tab-content.active {
      display: block;
    }

    /* Upload Area */
    .upload-container {
      background-color: #1A1A1A;
      border-radius: var(--radius-lg);
      padding: 32px;
      margin-bottom: 32px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .upload-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 24px;
    }

    .upload-area {
      border: 2px dashed rgba(255, 255, 255, 0.2);
      border-radius: var(--radius-lg);
      padding: 48px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .upload-area:hover {
      border-color: rgba(255, 255, 255, 0.4);
      background-color: rgba(255, 255, 255, 0.05);
    }

    .upload-icon {
      font-size: 48px;
      margin-bottom: 16px;
      color: rgba(255, 255, 255, 0.5);
    }

    .upload-text {
      font-size: 16px;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 8px;
    }

    .upload-hint {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.5);
    }

    /* File Preview */
    .file-preview {
      display: none;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-top: 24px;
    }

    .file-preview.show {
      display: flex;
      align-items: center;
      animation: fadeIn 0.3s ease-out;
    }

    .file-icon {
      font-size: 24px;
      margin-right: 16px;
      color: rgba(255, 255, 255, 0.6);
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .file-size {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
    }

    .remove-file {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      padding: 8px;
      border-radius: var(--radius-md);
      transition: var(--transition);
    }

    .remove-file:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--error);
    }

    /* Loading Animation */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .loading-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 3px solid var(--white);
      animation: spin 1s linear infinite;
    }

    .loading-text {
      position: absolute;
      margin-top: 80px;
      color: var(--white);
      font-size: 16px;
    }

    /* Delivery Options */
    .delivery-options {
      margin-top: 32px;
    }

    .options-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .radio-group {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .radio-option {
      flex: 1;
      min-width: 200px;
      background-color: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md);
      padding: 16px;
      cursor: pointer;
      transition: var(--transition);
    }

    .radio-option:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .radio-option.selected {
      border-color: var(--white);
      background-color: rgba(255, 255, 255, 0.1);
    }

    .radio-input {
      display: none;
    }

    .radio-label {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 500;
    }

    .radio-icon {
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      position: relative;
      transition: var(--transition);
    }

    .radio-option.selected .radio-icon {
      border-color: var(--white);
    }

    .radio-option.selected .radio-icon:after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 10px;
      height: 10px;
      background-color: var(--white);
      border-radius: 50%;
    }

    /* Summary Result */
    .summary-result {
      background-color: #1A1A1A;
      border-radius: var(--radius-lg);
      padding: 32px;
      margin-top: 32px;
      display: none;
      animation: slideIn 0.4s ease-out;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .summary-result.show {
      display: block;
    }

    .summary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .summary-title {
      font-size: 18px;
      font-weight: 600;
    }

    .summary-meta {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.5);
    }

    .summary-content {
      line-height: 1.6;
      white-space: pre-line;
      color: rgba(255, 255, 255, 0.8);
    }

    /* History Tab */
    .history-container {
      background-color: #1A1A1A;
      border-radius: var(--radius-lg);
      padding: 32px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .history-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 24px;
    }

    .history-empty {
      text-align: center;
      padding: 64px 0;
      color: rgba(255, 255, 255, 0.7);
    }

    .empty-illustration {
      width: 200px;
      height: 200px;
      margin: 0 auto 24px;
      opacity: 0.8;
    }

    .empty-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .empty-text {
      font-size: 16px;
      margin-bottom: 24px;
      color: rgba(255, 255, 255, 0.6);
    }

    .btn-highlight {
      display: inline-block;
      padding: 12px 24px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: var(--white);
      font-weight: 500;
      border-radius: var(--radius-md);
      border: none;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-highlight:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 24px;
    }

    .history-table th {
      text-align: left;
      padding: 12px 16px;
      background-color: rgba(255, 255, 255, 0.05);
      font-weight: 500;
      color: rgba(255, 255, 255, 0.8);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .history-table td {
      padding: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      color: rgba(255, 255, 255, 0.8);
    }

    .history-table tr:hover td {
      background-color: rgba(255, 255, 255, 0.05);
    }

    .table-actions {
      display: flex;
      gap: 12px;
    }

    .action-btn {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      padding: 4px;
      border-radius: var(--radius-sm);
      transition: var(--transition);
    }

    .action-btn:hover {
      color: var(--white);
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* Usage Stats */
    .usage-container {
      background-color: #1A1A1A;
      border-radius: var(--radius-lg);
      padding: 32px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .usage-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 32px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .stat-card {
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-md);
      padding: 24px;
      text-align: center;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .stat-label {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
    }

    .usage-progress {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      height: 8px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      transition: width 0.6s ease;
    }

    .progress-labels {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
    }

    .time-saved {
      margin-top: 32px;
      padding: 24px;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-lg);
      text-align: center;
      position: relative;
    }

    .time-saved-label {
      font-size: 16px;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 8px;
    }

    .time-saved-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #34c759, #4cd964);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .time-saved-message {
      font-size: 16px;
      color: rgba(255, 255, 255, 0.8);
    }

    .gamification-badge {
      position: absolute;
      top: -15px;
      right: -15px;
      background: linear-gradient(135deg, #ff9500, #ff2d55);
      color: var(--white);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(255, 45, 85, 0.3);
      animation: pulse 3s infinite;
    }

    .increase-limit-container {
      margin-top: 24px;
      text-align: center;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 24px;
      right: 24px;
      z-index: 1000;
    }

    .toast {
      background-color: #1A1A1A;
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 16px;
      min-width: 300px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: var(--shadow-lg);
      transform: translateX(120%);
      transition: transform 0.3s ease;
      border-left: 4px solid var(--white);
    }

    .toast.success {
      border-left-color: var(--success);
    }

    .toast.error {
      border-left-color: var(--error);
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast-icon {
      font-size: 20px;
    }

    .toast-content {
      flex: 1;
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .toast-message {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
    }

    .toast-close {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.5);
      cursor: pointer;
      padding: 4px;
      transition: var(--transition);
    }

    .toast-close:hover {
      color: var(--white);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .sidebar.expanded {
        width: 240px;
      }

      .main-content.sidebar-expanded {
        margin-left: 240px;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0 !important;
      }

      .dashboard-header {
        padding: 16px;
      }

      .content-area {
        padding: 24px 16px;
      }

      .radio-group {
        flex-direction: column;
      }

      .radio-option {
        width: 100%;
      }

      .history-table {
        display: block;
        overflow-x: auto;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .profile-name {
        display: none;
      }

      .toast {
        min-width: auto;
        width: calc(100vw - 48px);
      }
    }
  </style>
</head>
<body>
  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Processing your file...</div>
  </div>

  <!-- Login Page -->
  <div class="login-page" id="loginPage">
    <div class="login-container">
      <div class="login-header">
        <img src="https://res.cloudinary.com/duantsyvy/image/upload/Logo_Branco_Horizontal_c0r94o.png" alt="Aitomization Logo" class="login-logo">
        <h1 style="font-size: 24px; font-weight: 600; color: var(--white);">Access to the Summary Dashboard</h1>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label for="email" class="form-label">E-mail</label>
          <input type="email" id="email" class="form-input" placeholder="Your email" required>
          <div class="error-message" id="emailError">Please enter a valid email.</div>
        </div>
        <div class="form-group">
          <label for="password" class="form-label">Password</label>
          <input type="password" id="password" class="form-input" placeholder="Your password" required>
          <div class="error-message" id="passwordError">The password is required.</div>
        </div>
        <button type="submit" class="btn" id="loginBtn">login</button>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard" id="dashboardPage">
    <!-- Sidebar -->
    <div class="sidebar expanded" id="sidebar">
      <div class="sidebar-header">
        <img src="https://res.cloudinary.com/duantsyvy/image/upload/Logo_Branco_Horizontal_c0r94o.png" alt="Logo" class="sidebar-logo" id="sidebarLogo">
        <button class="sidebar-toggle" id="sidebarToggle">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-item">
          <a href="#" class="nav-link active" data-tab="upload">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
            <span class="nav-text">Upload and Summary</span>
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" data-tab="history">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 8v4l3 3"></path>
              <circle cx="12" cy="12" r="10"></circle>
            </svg>
            <span class="nav-text">History</span>
          </a>
        </div>
        <div class="nav-item">
          <a href="#" class="nav-link" data-tab="usage">
            <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path>
              <path d="M22 12A10 10 0 0 0 12 2v10z"></path>
            </svg>
            <span class="nav-text">Usage limit</span>
          </a>
        </div>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content sidebar-expanded" id="mainContent">
      <!-- Header -->
      <header class="dashboard-header">
        <h1 class="header-title">Dashboard</h1>
        <div class="header-actions">
          <button class="notification-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
              <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
            </svg>
            <span class="notification-badge"></span>
          </button>
          <div class="profile-dropdown">
            <button class="profile-btn" id="profileBtn">
              <div class="profile-avatar" id="profileAvatar">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
              </div>
              <span class="profile-name" id="profileName">Pedro</span>
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div class="profile-menu" id="profileMenu">
              <a href="#" class="menu-item" id="settingsBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
                Settings
              </a>
              <a href="#" class="menu-item danger" id="logoutBtn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                  <polyline points="16 17 21 12 16 7"></polyline>
                  <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                Log out
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- Content Area -->
      <div class="content-area">
        <!-- Upload Tab -->
        <div class="tab-content active" id="uploadTab">
          <div class="upload-container">
            <h2 class="upload-title">Upload your file to summarization</h2>
            <div class="upload-area" id="uploadArea">
              <div class="upload-icon">📄</div>
              <p class="upload-text">Drag your file here or click to select</p>
              <p class="upload-hint">Accepted formats: PDF, DOCX, TXT (Max 10MB)</p>
              <input type="file" id="fileInput" class="file-input" accept=".pdf,.docx,.txt">
            </div>
            <div class="file-preview" id="filePreview">
              <div class="file-icon">📄</div>
              <div class="file-info">
                <div class="file-name" id="fileName"></div>
                <div class="file-size" id="fileSize"></div>
              </div>
              <button class="remove-file" id="removeFile">✕</button>
            </div>

            <div class="delivery-options">
              <h3 class="options-title">How would you like to receive the summary?</h3>
              <div class="radio-group">
                <div class="radio-option selected" data-value="platform">
                  <input type="radio" name="deliveryOption" id="optionPlatform" class="radio-input" value="platform" checked>
                  <label class="radio-label" for="optionPlatform">
                    <span class="radio-icon"></span>
                    View on plataform
                  </label>
                </div>
                <div class="radio-option" data-value="email">
                  <input type="radio" name="deliveryOption" id="optionEmail" class="radio-input" value="email">
                  <label class="radio-label" for="optionEmail">
                    <span class="radio-icon"></span>
                    Receive by e-mail
                  </label>
                </div>
              </div>
            </div>

            <div class="submit-container">
              <button id="submitBtn" class="btn">Generate summary</button>
            </div>
          </div>

          <div class="summary-result" id="summaryResult">
            <div class="summary-header">
              <h3 class="summary-title">Sumary generated</h3>
              <div class="summary-meta" id="summaryMeta"></div>
            </div>
            <div class="summary-content" id="summaryContent"></div>
            <div class="summary-actions" style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
              <button id="downloadSummaryBtn" class="btn">Download Summary</button>
            </div>
          </div>
        </div>

        <!-- History Tab -->
        <div class="tab-content" id="historyTab">
          <div class="history-container">
            <h2 class="history-title">Summary History</h2>
            <div class="history-empty" id="historyEmpty">
              <img src="https://res.cloudinary.com/duantsyvy/image/upload/v1714329268/empty-folder_lixcxo.svg" alt="Empty History" class="empty-illustration">
              <h3 class="empty-title">No summaries yet</h3>
              <p class="empty-text">Upload a patient record to create your first summary</p>
              <button class="btn-highlight" id="createFirstSummaryBtn">Create your first summary</button>
            </div>
            
            <div id="historySummaries" style="display: none;">
              <table class="history-table">
                <thead>
                  <tr>
                    <th>Patient ID</th>
                    <th>Original Date</th>
                    <th>Summary Date</th>
                    <th>Document Type</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="historyTableBody">
                  <!-- Table rows will be added dynamically -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Usage Tab -->
        <div class="tab-content" id="usageTab">
          <div class="usage-container">
            <h2 class="usage-title">Usage limit</h2>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="usageCurrent">0</div>
                <div class="stat-label">Summaries used</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="usageRemaining">0</div>
                <div class="stat-label">Summaries remaining</div>
              </div>
            </div>
            <div class="usage-progress">
              <div class="progress-bar" id="usageProgressBar" style="width: 0%"></div>
            </div>
            <div class="progress-labels">
              <span>0% used</span>
              <span id="usagePercentage">0%</span>
            </div>
            
            <div class="time-saved">
              <div class="gamification-badge">Pro</div>
              <p class="time-saved-label">Time saved with our summaries</p>
              <div class="time-saved-value" id="timeSavedValue">0 minutes</div>
              <p class="time-saved-message" id="gamificationMessage">Keep up the good work! You're saving 0 minutes per day.</p>
            </div>
            
            <div class="increase-limit-container">
              <button class="btn-highlight" id="increaseLimit">Increase limit</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #1A1A1A; border-radius: 12px; padding: 24px; width: 90%; max-width: 500px; box-shadow: 0 10px 15px rgba(0,0,0,0.2);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 style="font-size: 20px; font-weight: 600; color: white;">Settings</h2>
        <button id="closeSettingsBtn" style="background: none; border: none; color: rgba(255,255,255,0.7); cursor: pointer; font-size: 20px;">&times;</button>
      </div>
      <form id="settingsForm">
        <div style="margin-bottom: 16px;">
          <label for="settingsName" style="display: block; margin-bottom: 8px; color: rgba(255,255,255,0.8);">Name</label>
          <input id="settingsName" type="text" placeholder="Your name" style="width: 100%; padding: 10px; background-color: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
        </div>
        <div style="margin-bottom: 16px;">
          <label for="settingsPhone" style="display: block; margin-bottom: 8px; color: rgba(255,255,255,0.8);">Phone</label>
          <input id="settingsPhone" type="text" placeholder="Your phone number" style="width: 100%; padding: 10px; background-color: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
        </div>
        <div style="margin-bottom: 16px;">
          <label for="settingsEmail" style="display: block; margin-bottom: 8px; color: rgba(255,255,255,0.8);">Email for summaries</label>
          <input id="settingsEmail" type="email" placeholder="Email to receive summaries" style="width: 100%; padding: 10px; background-color: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
        </div>
        <div style="margin-bottom: 24px;">
          <label for="settingsProfilePic" style="display: block; margin-bottom: 8px; color: rgba(255,255,255,0.8);">Profile Picture URL</label>
          <input id="settingsProfilePic" type="text" placeholder="URL to your profile picture" style="width: 100%; padding: 10px; background-color: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: white;">
        </div>
        <button type="submit" id="saveSettingsBtn" style="width: 100%; padding: 12px; background-color: white; color: black; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Save Changes</button>
      </form>
    </div>
  </div>

  <!-- View Summary Modal -->
  <div id="viewSummaryModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #1A1A1A; border-radius: 12px; padding: 24px; width: 90%; max-width: 600px; box-shadow: 0 10px 15px rgba(0,0,0,0.2);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 id="viewSummaryTitle" style="font-size: 20px; font-weight: 600; color: white;">Summary Details</h2>
        <button id="closeViewSummaryBtn" style="background: none; border: none; color: rgba(255,255,255,0.7); cursor: pointer; font-size: 20px;">&times;</button>
      </div>
      <div id="viewSummaryContent" style="max-height: 400px; overflow-y: auto; background-color: rgba(255,255,255,0.05); padding: 16px; border-radius: 6px; margin-bottom: 24px; color: rgba(255,255,255,0.9); white-space: pre-line;"></div>
      <div style="display: flex; justify-content: space-between;">
        <button id="shareSummaryBtn" style="padding: 10px 16px; background-color: rgba(255,255,255,0.1); color: white; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
          </svg>
          Share
        </button>
        <button id="downloadViewSummaryBtn" style="padding: 10px 16px; background-color: white; color: black; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
          Download
        </button>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const loginPage = document.getElementById('loginPage');
    const dashboardPage = document.getElementById('dashboardPage');
    const loginForm = document.getElementById('loginForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const emailError = document.getElementById('emailError');
    const passwordError = document.getElementById('passwordError');
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebarLogo = document.getElementById('sidebarLogo');
    const mainContent = document.getElementById('mainContent');
    const navLinks = document.querySelectorAll('.nav-link');
    const tabContents = document.querySelectorAll('.tab-content');
    const profileBtn = document.getElementById('profileBtn');
    const profileMenu = document.getElementById('profileMenu');
    const logoutBtn = document.getElementById('logoutBtn');
    const settingsBtn = document.getElementById('settingsBtn');
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const filePreview = document.getElementById('filePreview');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const removeFile = document.getElementById('removeFile');
    const radioOptions = document.querySelectorAll('.radio-option');
    const submitBtn = document.getElementById('submitBtn');
    const summaryResult = document.getElementById('summaryResult');
    const summaryContent = document.getElementById('summaryContent');
    const summaryMeta = document.getElementById('summaryMeta');
    const downloadSummaryBtn = document.getElementById('downloadSummaryBtn');
    const usageCurrent = document.getElementById('usageCurrent');
    const usageRemaining = document.getElementById('usageRemaining');
    const usageProgressBar = document.getElementById('usageProgressBar');
    const usagePercentage = document.getElementById('usagePercentage');
    const toastContainer = document.getElementById('toastContainer');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const historyEmpty = document.getElementById('historyEmpty');
    const historySummaries = document.getElementById('historySummaries');
    const historyTableBody = document.getElementById('historyTableBody');
    const createFirstSummaryBtn = document.getElementById('createFirstSummaryBtn');
    const timeSavedValue = document.getElementById('timeSavedValue');
    const gamificationMessage = document.getElementById('gamificationMessage');
    const increaseLimit = document.getElementById('increaseLimit');
    const profileAvatar = document.getElementById('profileAvatar');
    const profileName = document.getElementById('profileName');
    
    // Settings Modal
    const settingsModal = document.getElementById('settingsModal');
    const closeSettingsBtn = document.getElementById('closeSettingsBtn');
    const settingsForm = document.getElementById('settingsForm');
    const settingsName = document.getElementById('settingsName');
    const settingsPhone = document.getElementById('settingsPhone');
    const settingsEmail = document.getElementById('settingsEmail');
    const settingsProfilePic = document.getElementById('settingsProfilePic');
    const saveSettingsBtn = document.getElementById('saveSettingsBtn');
    
    // View Summary Modal
    const viewSummaryModal = document.getElementById('viewSummaryModal');
    const closeViewSummaryBtn = document.getElementById('closeViewSummaryBtn');
    const viewSummaryTitle = document.getElementById('viewSummaryTitle');
    const viewSummaryContent = document.getElementById('viewSummaryContent');
    const shareSummaryBtn = document.getElementById('shareSummaryBtn');
    const downloadViewSummaryBtn = document.getElementById('downloadViewSummaryBtn');

    // Global state
    let currentUser = null;
    let selectedFile = null;
    let selectedDeliveryOption = 'platform';
    let isSidebarExpanded = true;
    let fileFormat = null;
    let summaryHistory = [];
    let timeSaved = 0;
    let currentSummaryBase64 = null;
    let currentViewingSummary = null;

    // Check if user is already logged in
    function checkAuth() {
      const savedUser = localStorage.getItem('currentUser');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showDashboard();
        fetchUsageLimit();
        fetchProfileInfo();
      }
    }

    // Get profile information
    async function fetchProfileInfo() {
      if (!currentUser) return;
      
      try {
        const response = await fetch('https://n8nwebhook.server.aitomizationvps.com/webhook/profile-infos', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: currentUser.email
          })
        });
        
        const data = await response.json();
        
        if (data.result === 'success') {
          profileName.textContent = data.user_name;
          
          if (data.profile_pic) {
            profileAvatar.innerHTML = `<img src="${data.profile_pic}" alt="${data.user_name}" />`;
          }
          
          // Update current user with profile info
          currentUser.name = data.user_name;
          currentUser.profilePic = data.profile_pic;
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          
          // Also update settings form
          settingsName.value = data.user_name || '';
          settingsPhone.value = data.phone || '';
          settingsEmail.value = data.email_for_summaries || '';
          settingsProfilePic.value = data.profile_pic || '';
        }
      } catch (error) {
        console.error('Error fetching profile info:', error);
      }
    }

    // Settings modal
    settingsBtn.addEventListener('click', () => {
      profileMenu.classList.remove('show');
      settingsModal.style.display = 'block';
    });
    
    closeSettingsBtn.addEventListener('click', () => {
      settingsModal.style.display = 'none';
    });
    
    settingsForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Show loading overlay
      loadingOverlay.classList.add('show');
      
      // Prepare only the fields that were filled out
      const profileData = {};
      if (settingsName.value) profileData.user_name = settingsName.value;
      if (settingsPhone.value) profileData.phone = settingsPhone.value;
      if (settingsEmail.value) profileData.email_for_summaries = settingsEmail.value;
      if (settingsProfilePic.value) profileData.profile_pic = settingsProfilePic.value;
      
      try {
        const response = await fetch('https://n8nwebhook.server.aitomizationvps.com/webhook/update_profile', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(profileData)
        });
        
        const data = await response.json();
        
        if (data.result === 'sucess') {
          // Update profile display
          if (profileData.user_name) {
            profileName.textContent = profileData.user_name;
            currentUser.name = profileData.user_name;
          }
          
          if (profileData.profile_pic) {
            profileAvatar.innerHTML = `<img src="${profileData.profile_pic}" alt="${profileName.textContent}" />`;
            currentUser.profilePic = profileData.profile_pic;
          }
          
          // Update localStorage
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          
          showToast('Success', 'Your profile has been updated successfully.', 'success');
        } else {
          showToast('Error', 'Failed to update profile. Please try again.', 'error');
        }
      } catch (error) {
        console.error('Error updating profile:', error);
        showToast('Error', 'An error occurred while updating your profile.', 'error');
      } finally {
        loadingOverlay.classList.remove('show');
        settingsModal.style.display = 'none';
      }
    });

    // View Summary Modal
    closeViewSummaryBtn.addEventListener('click', () => {
      viewSummaryModal.style.display = 'none';
    });
    
    shareSummaryBtn.addEventListener('click', () => {
      if (!currentViewingSummary) return;
      
      navigator.clipboard.writeText(currentViewingSummary.content)
        .then(() => {
          showToast('Success', 'Summary copied to clipboard for sharing.', 'success');
        })
        .catch(() => {
          showToast('Error', 'Failed to copy summary to clipboard.', 'error');
        });
    });
    
    downloadViewSummaryBtn.addEventListener('click', () => {
      if (!currentViewingSummary || !currentViewingSummary.base64) {
        showToast('Error', 'No document available for download.', 'error');
        return;
      }
      
      // Download the file
      downloadBase64File(currentViewingSummary.base64, `summary-${currentViewingSummary.id}.txt`);
    });

    // Toggle sidebar
    sidebarToggle.addEventListener('click', () => {
      isSidebarExpanded = !isSidebarExpanded;
      sidebar.classList.toggle('expanded', isSidebarExpanded);
      sidebar.classList.toggle('collapsed', !isSidebarExpanded);
      mainContent.classList.toggle('sidebar-expanded', isSidebarExpanded);
      mainContent.classList.toggle('sidebar-collapsed', !isSidebarExpanded);
      
      if (!isSidebarExpanded) {
        sidebarLogo.style.display = 'none';
      } else {
        sidebarLogo.style.display = 'block';
      }
    });

    // Navigation
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const tabId = link.getAttribute('data-tab');
        
        // Update active states
        navLinks.forEach(nav => nav.classList.remove('active'));
        link.classList.add('active');
        
        // Show selected tab
        tabContents.forEach(content => content.classList.remove('active'));
        document.getElementById(`${tabId}Tab`).classList.add('active');
        
        // Additional actions based on tab
        if (tabId === 'usage') {
          fetchUsageLimit();
          updateTimeSaved();
        } else if (tabId === 'history') {
          loadSummaryHistory();
        }
      });
    });

    // Profile menu
    profileBtn.addEventListener('click', () => {
      profileMenu.classList.toggle('show');
    });

    // Close profile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
        profileMenu.classList.remove('show');
      }
    });

    // Login form submission
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Reset errors
      emailError.style.display = 'none';
      passwordError.style.display = 'none';
      
      // Validate inputs
      let isValid = true;
      
      if (!emailInput.value) {
        emailError.textContent = 'Please enter your e-mail.';
        emailError.style.display = 'block';
        isValid = false;
      } else if (!isValidEmail(emailInput.value)) {
        emailError.textContent = 'Please enter a valid e-mail.';
        emailError.style.display = 'block';
        isValid = false;
      }
      
      if (!passwordInput.value) {
        passwordError.textContent = 'Please enter your password.';
        passwordError.style.display = 'block';
        isValid = false;
      }
      
      if (!isValid) return;
      
      try {
        // Send authentication request
        const response = await fetch('https://n8nwebhook.server.aitomizationvps.com/webhook/autenticacao', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: emailInput.value,
            password: passwordInput.value
          })
        });
        
        const data = await response.json();
        
        if (data.result === 'sucess') {
          // Store user information
          currentUser = { email: emailInput.value };
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          
          // Show dashboard
          showDashboard();
          showToast('Success', 'Login successful!', 'success');
          
          // Fetch usage limit data and profile info
          fetchUsageLimit();
          fetchProfileInfo();
        } else {
          showToast('Error', 'Incorrect E-mail or password. Please Try again.', 'error');
        }
      } catch (error) {
        console.error('Authentication error:', error);
        showToast('Error', 'An error occurred while trying to log in. Please try again.', 'error');
      }
    });

    // Logout
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('currentUser');
      currentUser = null;
      selectedFile = null;
      resetFileUpload();
      profileMenu.classList.remove('show');
      summaryResult.style.display = 'none';
      loginPage.style.display = 'flex';
      dashboardPage.style.display = 'none';
      emailInput.value = '';
      passwordInput.value = '';
      
      // Reset active tab
      navLinks.forEach(nav => nav.classList.remove('active'));
      navLinks[0].classList.add('active');
      tabContents.forEach(content => content.classList.remove('active'));
      tabContents[0].classList.add('active');
    });

    // File upload handling
    uploadArea.addEventListener('click', () => {
      fileInput.click();
    });

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = 'var(--white)';
      uploadArea.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.style.borderColor = 'rgba(255, 255, 255, 0.2)';
      uploadArea.style.backgroundColor = 'transparent';
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = 'rgba(255, 255, 255, 0.2)';
      uploadArea.style.backgroundColor = 'transparent';
      
      if (e.dataTransfer.files.length) {
        handleFileSelection(e.dataTransfer.files[0]);
      }
    });

    fileInput.addEventListener('change', () => {
      if (fileInput.files.length) {
        handleFileSelection(fileInput.files[0]);
      }
    });

    removeFile.addEventListener('click', () => {
      resetFileUpload();
    });

    // Delivery option selection
    radioOptions.forEach(option => {
      option.addEventListener('click', () => {
        const value = option.getAttribute('data-value');
        const radio = option.querySelector('input[type="radio"]');
        
        radioOptions.forEach(opt => {
          opt.classList.remove('selected');
          opt.querySelector('input[type="radio"]').checked = false;
        });
        
        option.classList.add('selected');
        radio.checked = true;
        selectedDeliveryOption = value;
      });
    });

    // Create first summary button
    createFirstSummaryBtn.addEventListener('click', () => {
      // Switch to upload tab
      navLinks.forEach(nav => nav.classList.remove('active'));
      navLinks[0].classList.add('active');
      tabContents.forEach(content => content.classList.remove('active'));
      document.getElementById('uploadTab').classList.add('active');
    });

    // Increase limit button
    increaseLimit.addEventListener('click', () => {
      showToast('Contact us', 'Please contact our sales team to increase your limit.', 'success');
    });
    
    // Download summary button
    downloadSummaryBtn.addEventListener('click', () => {
      if (!currentSummaryBase64) {
        showToast('Error', 'No summary available for download.', 'error');
        return;
      }
      
      downloadBase64File(currentSummaryBase64, 'summary-' + new Date().toISOString().split('T')[0] + '.txt');
    });

    // Submit button
    submitBtn.addEventListener('click', async () => {
      if (!selectedFile) {
        showToast('Warning', 'Please select a file to continue.', 'error');
        return;
      }
      
      // Show loading overlay
      loadingOverlay.classList.add('show');
      
      try {
        const formData = new FormData();
        formData.append('email', currentUser.email);
        formData.append('file', selectedFile);
        formData.append('deliveryOption', selectedDeliveryOption);
        formData.append('fileFormat', fileFormat); // Add file format to the payload
        
        const response = await fetch('https://n8neditor.server.aitomizationvps.com/webhook/resumir-arq', {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        // Hide loading overlay
        loadingOverlay.classList.remove('show');
        
        if (data.result === 'sucess') {
          showToast('Success', 'Summary generated successfully!', 'success');
          
          // Store base64 for download
          currentSummaryBase64 = data.base64;
          
          // Add to summary history
          addToSummaryHistory(selectedFile.name, data.content, data.base64);
          
          if (selectedDeliveryOption === 'platform' && data.content) {
            summaryContent.textContent = data.content;
            summaryMeta.textContent = `Generated on ${formatDate(new Date())} • ${selectedFile.name}`;
            summaryResult.style.display = 'block';
          } else {
            showToast('Sent', `The summary has been sent to your email.`, 'success');
          }
          
          resetFileUpload();
          fetchUsageLimit();
          updateTimeSaved();
        } else {
          showToast('Error', 'An error occurred while generating the summary. Please try again.', 'error');
        }
      } catch (error) {
        // Hide loading overlay on error
        loadingOverlay.classList.remove('show');
        console.error('Error generating summary:', error);
        showToast('Error', 'An error occurred while processing your request. Please try again.', 'error');
      }
    });

    // Add to summary history
    function addToSummaryHistory(filename, content, base64) {
      const now = new Date();
      const documentDate = new Date(now);
      documentDate.setDate(documentDate.getDate() - Math.floor(Math.random() * 30)); // Random date within the last 30 days
      
      const patientId = 'P' + Math.floor(Math.random() * 10000).toString().padStart(4, '0');
      const docType = fileFormat ? fileFormat.toUpperCase() : 'Document';
      
      const summary = {
        id: Date.now(),
        patientId: patientId,
        documentDate: documentDate,
        summaryDate: now,
        documentType: docType,
        filename: filename,
        content: content,
        base64: base64
      };
      
      // Get existing history from localStorage or initialize empty array
      let history = JSON.parse(localStorage.getItem('summaryHistory') || '[]');
      history.push(summary);
      
      // Save to localStorage
      localStorage.setItem('summaryHistory', JSON.stringify(history));
      
      // Update global variable
      summaryHistory = history;
    }

    // Load summary history
    function loadSummaryHistory() {
      // Get history from localStorage
      summaryHistory = JSON.parse(localStorage.getItem('summaryHistory') || '[]');
      
      if (summaryHistory.length === 0) {
        historyEmpty.style.display = 'block';
        historySummaries.style.display = 'none';
        return;
      }
      
      // Show table, hide empty state
      historyEmpty.style.display = 'none';
      historySummaries.style.display = 'block';
      
      // Clear existing rows
      historyTableBody.innerHTML = '';
      
      // Add rows for each summary
      summaryHistory.forEach(summary => {
        const row = document.createElement('tr');
        
        row.innerHTML = `
          <td>${summary.patientId}</td>
          <td>${formatDate(new Date(summary.documentDate))}</td>
          <td>${formatDate(new Date(summary.summaryDate))}</td>
          <td>${summary.documentType}</td>
          <td class="table-actions">
            <button class="action-btn view-btn" data-id="${summary.id}">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
            <button class="action-btn share-btn" data-id="${summary.id}">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
              </svg>
            </button>
            <button class="action-btn download-btn" data-id="${summary.id}">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </button>
          </td>
        `;
        
        historyTableBody.appendChild(row);
      });
      
      // Add event listeners to action buttons
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = parseInt(btn.getAttribute('data-id'));
          const summary = summaryHistory.find(s => s.id === id);
          
          if (summary) {
            viewSummaryTitle.textContent = `Summary: ${summary.patientId} - ${summary.documentType}`;
            viewSummaryContent.textContent = summary.content || 'No content available.';
            currentViewingSummary = summary;
            viewSummaryModal.style.display = 'block';
          }
        });
      });
      
      document.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = parseInt(btn.getAttribute('data-id'));
          const summary = summaryHistory.find(s => s.id === id);
          
          if (summary && summary.content) {
            navigator.clipboard.writeText(summary.content)
              .then(() => {
                showToast('Success', 'Summary copied to clipboard for sharing.', 'success');
              })
              .catch(() => {
                showToast('Error', 'Failed to copy summary to clipboard.', 'error');
              });
          }
        });
      });
      
      document.querySelectorAll('.download-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = parseInt(btn.getAttribute('data-id'));
          const summary = summaryHistory.find(s => s.id === id);
          
          if (summary && summary.base64) {
            downloadBase64File(summary.base64, `summary-${summary.patientId}.txt`);
          } else {
            showToast('Error', 'No document available for download.', 'error');
          }
        });
      });
    }
    
    // Download a base64 file
    function downloadBase64File(base64, fileName) {
      try {
        // Convert base64 to blob
        const byteCharacters = atob(base64);
        const byteNumbers = new Array(byteCharacters.length);
        for (let i = 0; i < byteCharacters.length; i++) {
          byteNumbers[i] = byteCharacters.charCodeAt(i);
        }
        const byteArray = new Uint8Array(byteNumbers);
        const blob = new Blob([byteArray], { type: 'text/plain' });
        
        // Create a download link
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        
        // Clean up
        setTimeout(() => {
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }, 100);
        
        showToast('Success', 'Download started', 'success');
      } catch (error) {
        console.error('Download error:', error);
        showToast('Error', 'Failed to download the file', 'error');
      }
    }

    // Update time saved calculation
    function updateTimeSaved() {
      const usedSummaries = parseInt(usageCurrent.textContent) || 0;
      
      // Calculate time saved (assume each summary saves ~15 minutes)
      const minutes = usedSummaries * 15;
      timeSaved = minutes;
      
      // Update UI
      timeSavedValue.textContent = formatTimeSaved(minutes);
      
      // Update gamification message
      const dailyMinutes = Math.round(minutes / 30); // Assuming 30 days
      gamificationMessage.textContent = `Keep up the good work! You're saving ${dailyMinutes} minutes per day.`;
    }

    // Format time saved
    function formatTimeSaved(minutes) {
      if (minutes < 60) {
        return `${minutes} minutes`;
      } else {
        const hours = Math.floor(minutes / 60);
        const remainingMinutes = minutes % 60;
        
        if (remainingMinutes === 0) {
          return `${hours} hour${hours > 1 ? 's' : ''}`;
        } else {
          return `${hours} hour${hours > 1 ? 's' : ''} and ${remainingMinutes} minute${remainingMinutes > 1 ? 's' : ''}`;
        }
      }
    }

    // Helper Functions
    function handleFileSelection(file) {
      const maxSize = 10 * 1024 * 1024; // 10MB
      const allowedTypes = ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'text/plain'];
      
      if (file.size > maxSize) {
        showToast('Error', 'The file exceeds the maximum size of 10MB.', 'error');
        return;
      }
      
      if (!allowedTypes.includes(file.type)) {
        showToast('Error', 'Unsupported file format. Please use PDF, DOCX or TXT.', 'error');
        return;
      }
      
      // Determine file format for the webhook payload
      if (file.type === 'application/pdf') {
        fileFormat = 'pdf';
      } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
        fileFormat = 'docx';
      } else if (file.type === 'text/plain') {
        fileFormat = 'txt';
      }
      
      selectedFile = file;
      fileName.textContent = file.name;
      fileSize.textContent = formatFileSize(file.size);
      uploadArea.style.display = 'none';
      filePreview.classList.add('show');
    }

    function resetFileUpload() {
      selectedFile = null;
      fileFormat = null;
      fileInput.value = '';
      uploadArea.style.display = 'block';
      filePreview.classList.remove('show');
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' bytes';
      else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
      else return (bytes / 1048576).toFixed(1) + ' MB';
    }

    function formatDate(date) {
      const day = date.getDate().toString().padStart(2, '0');
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const year = date.getFullYear();
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      
      return `${day}/${month}/${year} at ${hours}:${minutes}`;
    }

    function isValidEmail(email) {
      const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return regex.test(email);
    }

    function showDashboard() {
      loginPage.style.display = 'none';
      dashboardPage.style.display = 'block';
    }

    async function fetchUsageLimit() {
      if (!currentUser) return;
      
      try {
        const response = await fetch('https://n8nwebhook.server.aitomizationvps.com/webhook/verifica-limite-de-uso', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: currentUser.email
          })
        });
        
        const data = await response.json();
        
        if (data.result === 'sucess') {
          const current = data['usage_atual'];
          const remaining = data['uso-restante'];
          const total = current + remaining;
          const percentage = Math.round((current / total) * 100);
          
          usageCurrent.textContent = current;
          usageRemaining.textContent = remaining;
          usageProgressBar.style.width = `${percentage}%`;
          usagePercentage.textContent = `${percentage}%`;
          
          // Update time saved based on usage
          updateTimeSaved();
          
          // Show warning if limit is close
          if (remaining <= total * 0.1) { // 10% or less remaining
            showToast('Limit Warning', 'You are close to your usage limit.', 'error');
            increaseLimit.style.display = 'inline-block';
          } else {
            increaseLimit.style.display = 'none';
          }
        }
      } catch (error) {
        console.error('Error fetching usage limit:', error);
      }
    }

    function showToast(title, message, type = 'default') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      let iconHtml = '';
      if (type === 'success') {
        iconHtml = '✓';
      } else if (type === 'error') {
        iconHtml = '✗';
      }
      
      toast.innerHTML = `
        <div class="toast-icon">${iconHtml}</div>
        <div class="toast-content">
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        </div>
        <button class="toast-close">✕</button>
      `;
      
      toastContainer.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('show');
      }, 10);
      
      const timeout = setTimeout(() => {
        removeToast(toast);
      }, 5000);
      
      const closeBtn = toast.querySelector('.toast-close');
      closeBtn.addEventListener('click', () => {
        clearTimeout(timeout);
        removeToast(toast);
      });
    }

    function removeToast(toast) {
      toast.classList.remove('show');
      setTimeout(() => {
        toast.remove();
      }, 300);
    }

    // Initialize app
    window.addEventListener('DOMContentLoaded', () => {
      checkAuth();
    });
  </script>
</body>
</html>
